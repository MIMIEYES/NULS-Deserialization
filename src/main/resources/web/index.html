<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NULS Deserialization</title>
    <link rel="stylesheet" type="text/css" href="/css/jquery.jsonview.min.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery.jsonview.min.js"></script>
    <script type="text/javascript">

        $(function() {
            $('#toggle-btn1').on('click', function() {
                $('#json1').JSONView('toggle');
            });
        });
        $(document).ready(function(){
            $('#Form1').bind('submit', function(){
                var dataPara = getFormJson(this);
                org.method = dataPara.jsonrpcMethod;
                org.params = [dataPara.chainId, dataPara.txHex, dataPara.prefix];
                ajaxSubmit(this, 1);
                return false;
            });
        });

        $(function() {
            $('#toggle-btn2').on('click', function() {
                $('#json2').JSONView('toggle');
            });
        });
        $(document).ready(function(){
            $('#Form2').bind('submit', function(){
                var dataPara = getFormJson(this);
                org.method = dataPara.jsonrpcMethod;
                org.params = [dataPara.chainId, dataPara.txType, dataPara.txDataHex, dataPara.prefix];
                ajaxSubmit(this, 2);
                return false;
            });
        });
        var org = {
            "jsonrpc":"2.0",
            "method":"",
            "params":[],
            "id":1234
        };
        //将form转为AJAX提交
        function ajaxSubmit(frm, i) {
            $.ajax({
                //请求方式
                type: "POST",
                //文件位置
                url: frm.action,
                headers: {'Content-Type':'application/json;charset=utf-8'},
                data: JSON.stringify(org),
                //返回数据格式为json,也可以是其他格式如
                dataType: "json",
                //请求成功后要执行的函数，拼接html
                success: function(obj){
                    if(obj.result) {
                        $("#json"+i).JSONView(obj.result);
                        // $("div").append(JSON.stringify(obj.result));
                    } else {
                        $("#json"+i).JSONView(obj);
                        // $("div").append(JSON.stringify(obj));
                    }
                }
            });
        }
        //将form中的值转换为键值对。
        function getFormJson(frm) {
            var o = {};
            var a = $(frm).serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        }
    </script>
</head>
<body>
<h2>NULS 反序列化</h2>

<h3>1. 交易</h3>
<form id="Form1" action="/api/jsonrpc/" method="post" >
    <input name="jsonrpcMethod" type="hidden" value="deserializationTx" />
    <table border="0">
        <tr>
            <td align="right">chainId: </td><td><input name="chainId" type="text" /><br /></td>
        </tr>
        <tr>
            <td align="right">交易序列化数据: </td><td><input name="txHex" type="text" /><br /></td>
        </tr>
        <tr>
            <td align="right">地址前缀: </td><td><input name="prefix" type="text" /><br /></td>
        </tr>
        <tr>
            <td colspan="2" align="right"><input type="submit" value="点击反序列化" /><br /></td>
        </tr>
    </table>

</form>
<h4>反序列化数据</h4>
<button id="toggle-btn1">展开或折叠</button>
<div id="json1"></div>
<hr>
<h3>2. 交易业务数据(txData)</h3>
<form id="Form2" action="/api/jsonrpc/" method="post" >
    <input name="jsonrpcMethod" type="hidden" value="deserializationTxData" />
    <table border="0">
        <tr>
            <td align="right">chainId: </td><td><input name="chainId" type="text" /><br /></td>
        </tr>
        <tr>
            <td align="right">交易类型: </td><td><input name="txType" type="text" /><br /></td>
        </tr>
        <tr>
            <td align="right">交易业务序列化数据: </td><td><input name="txDataHex" type="text" /><br /></td>
        </tr>
        <tr>
            <td align="right">地址前缀: </td><td><input name="prefix" type="text" /><br /></td>
        </tr>
        <tr>
            <td colspan="2" align="right"><input type="submit" value="点击反序列化" /><br /></td>
        </tr>
    </table>

</form>
<h4>反序列化数据</h4>
<button id="toggle-btn2">展开或折叠</button>
<div id="json2"></div>
</body>
</html>