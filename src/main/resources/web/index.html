<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ajax请求json数据</title>
    <link rel="stylesheet" type="text/css" href="/css/jquery.jsonview.min.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="/js/jquery.jsonview.min.js"></script>
    <script type="text/javascript">

        $(function() {
            $('#toggle-btn').on('click', function() {
                $('#json').JSONView('toggle');
            });
        });
        // $(function(){
        //     $.ajax({
        //         //请求方式
        //         type:"POST",
        //         //文件位置
        //         url:"/api/jsonrpc/",
        //         headers:{'Content-Type':'application/json;charset=utf-8'},
        //         data: JSON.stringify(org),
        //         //返回数据格式为json,也可以是其他格式如
        //         dataType: "json",
        //         //请求成功后要执行的函数，拼接html
        //         success: function(obj){
        //             if(obj.result) {
        //                 $("#json").JSONView(obj.result);
        //                 // $("div").append(JSON.stringify(obj.result));
        //             } else {
        //                 $("#json").JSONView(obj);
        //                 // $("div").append(JSON.stringify(obj));
        //             }
        //         }
        //     });
        // });
        $(document).ready(function(){
            $('#Form1').bind('submit', function(){
                ajaxSubmit(this);
                return false;
            });
        });
        var org = {
            "jsonrpc":"2.0",
            "method":"",
            "params":[],
            "id":1234
        };
        //将form转为AJAX提交
        function ajaxSubmit(frm) {
            var dataPara = getFormJson(frm);
            org.method = dataPara.jsonrpcMethod;
            org.params = [dataPara.chainId, dataPara.txHex];
            $.ajax({
                //请求方式
                type: "POST",
                //文件位置
                url: frm.action,
                headers: {'Content-Type':'application/json;charset=utf-8'},
                data: JSON.stringify(org),
                //返回数据格式为json,也可以是其他格式如
                dataType: "json",
                //请求成功后要执行的函数，拼接html
                success: function(obj){
                    if(obj.result) {
                        $("#json").JSONView(obj.result);
                        // $("div").append(JSON.stringify(obj.result));
                    } else {
                        $("#json").JSONView(obj);
                        // $("div").append(JSON.stringify(obj));
                    }
                }
            });
        }
        //将form中的值转换为键值对。
        function getFormJson(frm) {
            var o = {};
            var a = $(frm).serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        }
    </script>
</head>
<body>
<h2>NULS 反序列化</h2>

<form id="Form1" action="/api/jsonrpc/" method="post" >
    <input name="jsonrpcMethod" type="hidden" value="deserializationTx" />
    <table border="0">
        <tr>
            <td align="right">chainId: </td><td><input name="chainId" type="text" /><br /></td>
        </tr>
        <tr>
            <td align="right">交易序列化数据: </td><td><input name="txHex" type="text" /><br /></td>
        </tr>
        <tr>
            <td colspan="2" align="right"><input type="submit" value="点击反序列化" /><br /></td>
        </tr>
    </table>

</form>
<h3>反序列化数据</h3>
<button id="toggle-btn">展开或折叠</button>
<div id="json"></div>
</body>
</html>